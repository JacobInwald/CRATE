
\renewcommand{\t}[1]{\texttt{#1}}

\newcommand{\stackFrameTable}{
    \begin{tikzpicture}[%
        auto,
        block/.style={
            rectangle,
            draw=black,
            thick,
            text width=7.5em,
            align=center,
            minimum height=2em,
          },
        stackblock/.style={
          rectangle,
          draw=green,
          fill=green!20,
          thick,
          text width=7.5em,
          align=center,
          minimum height=2em,
        },
        dotsstyle/.style={
            rectangle,
            thick,
            text width=7.5em,
            align=center,
            minimum height=2em
          }
    ]
        \node (dots1) [dotsstyle] 
        { \dots };
        \node (main) [block, below=-0.8pt of dots1] 
            {\rotatebox{90}{$\cdots$}};
        \node (args2) [stackblock, below=-0.8pt of main] 
            {argv[1]};
        \node (args1) [stackblock, below=-0.8pt of args2, rectangle]
            {argv[0]};
        \node (rbp) [stackblock, below=-0.8pt of args1, rectangle]
                {return address};
        \node (sebp) [stackblock, below=-0.8pt of rbp, rectangle]
            {previous \%rbp};
        \node (l1) [stackblock, below=-0.8pt of sebp, rectangle]
            {local var 1};
        \node (l2) [stackblock, below=-0.8pt of l1, rectangle]
            {local var 2};
        \node (dots2) [dotsstyle, below=-0.8pt of l2] 
            { \dots };

        \draw [thick, rounded corners=.5em] 
        ([xshift=0.4pt]dots1.north west) rectangle ([xshift=-0.4pt]dots2.south east);

        \node (ebp) [left=2.5em of sebp] {\%rbp};
        \draw[->, very thick]        (ebp)   -- (sebp);

        \node (prbp) [left=2.5em of main, text width=3em, align=center] {previous \%rbp};
        \draw[->, very thick]        (prbp)   -- (main);

        \node (esp) [left=2.5em of l2.south west] {\%rsp};
        \draw[->, very thick]        (esp)   -- (l2.south west);
        


        \node (highaddrlabel) [above= 2pt of dots1] {
            High Memory Addresses
        };

        \node (lowaddrlabel) [below= 2pt of dots2] {
            Low Memory Addresses
        };


        \draw[->, very thick] 
            ([xshift=1em]dots1.north east) --
            ([xshift=1em]dots2.south east)  node[midway,above, sloped] () {stack growth};
    \end{tikzpicture}
}

\newcommand{\stackFrameTableCanary}{
    \begin{tikzpicture}[%
        auto,
        block/.style={
            rectangle,
            draw=black,
            thick,
            text width=7.5em,
            align=center,
            minimum height=2em,
          },
        stackblock/.style={
          rectangle,
          draw=green,
          fill=green!20,
          thick,
          text width=7.5em,
          align=center,
          minimum height=2em,
        },
        stackblock2/.style={
          rectangle,
          draw=blue,
          fill=blue!20,
          thick,
          text width=7.5em,
          align=center,
          minimum height=2em,
        },
        dotsstyle/.style={
            rectangle,
            thick,
            text width=7.5em,
            align=center,
            minimum height=2em
          }
    ]
        \node (dots1) [dotsstyle] 
            { \dots };
        \node (main) [block, below=-0.8pt of dots1] 
            {\rotatebox{90}{$\cdots$}};
        \node (args2) [stackblock, below=-0.8pt of main] 
            {argv[1]};
        \node (args1) [stackblock, below=-0.8pt of args2, rectangle]
            {argv[0]};
        \node (rbp) [stackblock, below=-0.8pt of args1, rectangle]
            {return address};
        \node (sebp) [stackblock, below=-0.8pt of rbp, rectangle]
            {previous \%rbp};
        \node (canary) [stackblock2, below=-0.8pt of sebp, rectangle]
                {canary value};
        \node (l1) [stackblock, below=-0.8pt of canary, rectangle]
            {local var 1};
        \node (l2) [stackblock, below=-0.8pt of l1, rectangle]
            {local var 2};
        \node (dots2) [dotsstyle, below=-0.8pt of l2] 
            { \dots };

        \draw [thick, rounded corners=.5em] 
        ([xshift=0.4pt]dots1.north west) rectangle ([xshift=-0.4pt]dots2.south east);

        \node (ebp) [left=2.5em of sebp] {\%rbp};
        \draw[->, very thick]        (ebp)   -- (sebp);

        \node (prbp) [left=2.5em of main, text width=3em, align=center] {previous \%rbp};
        \draw[->, very thick]        (prbp)   -- (main);

        \node (esp) [left=2.5em of l2.south west] {\%rsp};
        \draw[->, very thick]        (esp)   -- (l2.south west);


        \node (highaddrlabel) [above= 2pt of dots1] {
            High Memory Addresses
        };

        \node (lowaddrlabel) [below= 2pt of dots2] {
            Low Memory Addresses
        };

        \draw[->, very thick] 
            ([xshift=1em]dots1.north east) --
            ([xshift=1em]dots2.south east)  node[midway,above, sloped] () {stack growth};
    \end{tikzpicture}
}
