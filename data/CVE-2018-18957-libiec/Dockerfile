# syntax=docker/dockerfile:1
FROM pihole/debian-base
WORKDIR /home/

# Install dependencies
RUN apt-get -y update && apt-get -y install --no-install-recommends \ 
    git \
    cmake \
    build-essential \
    libxml2-dev \
    sudo \ 
    zsh \
    meson \
    ninja-build \
    wget \
    ca-certificates

# Install software
RUN git clone -c http.sslverify=false https://github.com/mz-automation/libiec61850 ./libiec61850 && \
    cd libiec61850 && \
    git checkout v1.3.0 --

# Adds in tooling to allow for different hardening measures to be used
ADD Makefile.patch ./
RUN patch -p1 libiec61850/Makefile < Makefile.patch

# Set environment variable for adding hardening flags
ENV HARDEN_FLAGS=""

# Add in demo script
ADD demo-exploit.sh ./
RUN chmod +x demo-exploit.sh
