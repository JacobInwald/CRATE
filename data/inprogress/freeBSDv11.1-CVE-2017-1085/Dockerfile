# syntax=docker/dockerfile:1
FROM pihole/debian-base
WORKDIR /home/

# Install dependencies
RUN apt-get -y update && \ 
    apt-get install -y --no-install-recommends git \
    cmake \
    build-essential \
    libxml2-dev \
    qemu-system \
    libvirt-daemon-system \ 
    qemu-utils 

# Setup QEMU
RUN qemu-img create -f qcow2 freebsd.qcow 30G

# Download FreeBSD source code
RUN git clone -c http.sslverify=false https://github.com/freebsd/freebsd-src && \
    cd freebsd-src


RUN cd freebsd-src && \
    git checkout releng/11.1

# Compile the kernel
# RUN cd freebsd-src && \
#     ./release/release.sh

# # Install software
# # ADD fstack-clash-protection.c ./

# # Set environment variable for adding hardening flags
# ENV HARDEN_FLAGS=""

# # Add in demo script
# ADD demo-exploit.sh ./
# RUN chmod +x demo-exploit.sh
