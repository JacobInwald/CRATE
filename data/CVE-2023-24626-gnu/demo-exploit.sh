#!/bin/sh

# build
echo "[+] building GNU screens with provided hardening flags"
cd /home/screen/src
export CFLAGS="$HARDEN_FLAG"
# ./configure
make clean
make -j64
sudo make install


# run
cd /home 
echo "[+] Setting up root listener script"
./sighup_listen.py > out &
sleep 1
# exec su user
echo "[+] Setting up non-root user screen process"
su user -c "screen -dmS test_screen"
sleep 1
echo "[+] Switching to non-root user and running exploit"
su user -c "./exploit.py $!"
sleep 3
cat out | grep -q "SIGHUP" && echo "[!] Exploit Successful!" || echo "[!] Exploit Unsucessful!"
