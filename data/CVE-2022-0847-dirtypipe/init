#!/bin/sh
mount -t devtmpfs none /dev
mount -t proc none /proc
mount -t sysfs none /sys
mknod -m 666 /dev/ttyS0 c 4 64

# Setup accounts
touch /etc/passwd
chmod 755 /etc/passwd
adduser user -D -s /bin/sh
cp /etc/passwd /etc/passwd.orig

chmod +x /exploit.sh 
chown user /exploit.sh
chown user /home/write_anything


echo -e "\nBoot took $(cut -d' ' -f1 /proc/uptime) seconds\n"

echo -e " ______ _      _           ______ _              "
echo -e " |  _  (_)    | |          | ___ (_)             "
echo -e " | | | |_ _ __| |_ _   _   | |_/ /_ _ __   ___   "
echo -e " | | | | | '__| __| | | |  |  __/| | '_ \ / _ \  "
echo -e " | |/ /| | |  | |_| |_| |  | |   | | |_) |  __/  "
echo -e " |___/ |_|_|   \__|\__, |  \_|   |_| .__/ \___|  "
echo -e "                    __/ |          | |           "
echo -e "                   |___/           |_|           \n"
echo -e "[!] Welcome the the Dirty Pipe demo!\n"
echo -e "[!] To get started, run the following command:"
echo -e "# ./exploit\n"
echo -e "[!] You should see that the passwd file has been modified!\n"
echo -e "[!] Use Ctrl + A and then c then q to exit the screen session ...\n"
echo -e ""

setsid cttyhack /bin/su user 
# setsid  cttyhack sh
# exec /bin/sh
