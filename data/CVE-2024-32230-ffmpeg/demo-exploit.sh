#!/bin/bash

RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color
SEGSIG=139

cd ffmpeg
# build
rm libavcodec/mpegvideo_enc.o
# CFLAGS="-g -fsanitize=address" LDFLAGS="-fsanitize=address"
./configure --extra-cflags="${HARDEN_FLAGS}"
make -j64
make install -j64
# run
./ffmpeg_g -y -i ../poc21ffmpeg tmp.mp4

if [[ "$?" -eq "$SEGSIG" ]]
then 
  echo ""
  echo "Exploit Successful"
else
  echo ""
  echo "Exploit Unsuccessful"
fi
