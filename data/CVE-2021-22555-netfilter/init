#!/bin/sh
mount -t devtmpfs none /dev
mount -t proc none /proc
mount -t sysfs none /sys
mknod -m 666 /dev/ttyS0 c 4 64

# Setup accounts
touch /etc/passwd
chmod 644 /etc/passwd
adduser jacob
cp /etc/passwd /etc/passwd.orig
chmod +x exploit.sh 
echo -e "\nBoot took $(cut -d' ' -f1 /proc/uptime) seconds\n"
echo -e "                                   _    __ _ _ _                                           "
echo -e "                                  | |  / _(_) | |                                          "
echo -e "                        _ __   ___| |_| |_ _| | |_ ___ _ __                                "
echo -e "                       | | | |  __/ |_| | | | | ||  __/ |                                  "
echo -e "                       | '_ \ / _ \ __|  _| | | __/ _ \ '__|                               "
echo -e "                       |_| |_|\___|\__|_| |_|_|\__\___|_|                                  \n"
                                                                                            
                                                                                            
# echo -e " _____ _   _ _____       _____  _____  _____  __        _____  _____  _____ _____ _____     "
# echo -e "/  __ \ | | |  ___|     / __  \|  _  |/ __  \/  |      / __  \/ __  \|  ___|  ___|  ___|    "
# echo -e "| /  \/ | | | |__ ______ ' / /'| |/' |`' / /'`| |______`' / /'`' / /'|___ \|___ \|___ \     "
# echo -e "| |   | | | |  __|______| / /  |  /| |  / /   | |______| / /    / /      \ \   \ \   \ \    "
# echo -e "| \__/\ \_/ / |___      ./ /___\ |_/ /./ /____| |_     ./ /___./ /___/\__/ /\__/ /\__/ /    "
# echo -e " \____/\___/\____/      \_____/ \___/ \_____/\___/     \_____/\_____/\____/\____/\____/     \n"

echo -e "[!] Welcome the the CVE-2021-22555 demo!\n"
echo -e "[!] To get started, run the following command:"
echo -e "# ./exploit\n"
echo -e "[!] You should see that the passwd file has been modified!\n"
echo -e "[!] Use Ctrl + A and then c then q to exit the screen session ...\n"
echo -e ""

setsid cttyhack sh
# setsid  cttyhack sh
# exec /bin/sh
